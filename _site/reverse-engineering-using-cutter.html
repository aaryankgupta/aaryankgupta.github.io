<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Pradipta  Bora | Reverse Engineering using Cutter</title>
<meta name="description" content="">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />
<script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@3.6.4/dist/js/splide.min.js"></script>
<!-- Styles -->
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@3.6.4/dist/css/splide.min.css">

<link rel="canonical" href="/reverse-engineering-using-cutter">

<script>
 document.addEventListener( 'DOMContentLoaded', function () {
  new Splide( '#image-slider', {
		width : '100vw',
		height: '100vh',
  } ).mount();
} );
</script>

<!-- Theming-->



  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3TBBHYXXPR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-3TBBHYXXPR');
  </script>


    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="http://localhost:4000//">
       <span class="font-weight-bold">Pradipta</span>   Bora
      </a>
      
      <!-- Navbar Toogle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              About
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item ">
            <a class="nav-link" href="/blog/">
              Blog
              
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/cv.pdf">
              CV
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                Projects
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/teaching/">
                Teaching
                
              </a>
          </li>
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Reverse Engineering using Cutter</h1>
    <p class="post-meta">July 23, 2020</p>
  </header>

  <article class="post-content">
    <p>In the last tutorial we investigated using assembly for reverse engineering by using IDA to observe the assembly code of the executable. Understanding assembly is incredibly useful and allows one to understand how the internals of the program are working. However sometimes figuring and reversing the logic of the program using just assembly becomes extremely difficuly especially if the program is complicated.</p>

<p>Fortunately a different class of programs known as decompilers allow us to essentially get the pseudocode from the assembly generated and use this to reverse the program. Ofcourse this code won’t be perfect and in most cases it won’t run. But analysing this pseudocode is far easier than working with assembly and we will be seeing how we can use this to solve problems.</p>

<p>We will be using the ghidra decompiler written by the National Security Agency (it is opensourced so you don’t have to worry about security risks). ghidra is a complete reversing toolkit which is very powerful however it can be a bit non friendly to use. Instead we will use cutter which is based on the radare2 platform and uses ghidra for decompilation.</p>

<h3 id="installing-cutter">Installing Cutter</h3>

<p>You’ll first have to install radare2 which provides a lot of tools for disassembly and reversing via the terminal.</p>

<p>Follow this <a href="https://radare.mikelloc.com/list">link</a> to get the binary installer for your platform.</p>

<p>Once this is done you can simply download the cutter appimage from <a href="https://cutter.re/">here</a></p>

<p>The appimage file can simply be doubleclicked to run cutter. You will have to set it up as an allowed executable though. You can do this by simplying running the following command:</p>

<figure class="highlight"><pre><code class="language-assembly" data-lang="assembly">chmod +x Cutter-v1.10.3-x64.Linux.AppImage</code></pre></figure>

<p>Now double click the appimage to run Cutter.</p>

<h3 id="solving-a-crackme-using-cutter-and-ghidra">Solving a crackme using Cutter and Ghidra</h3>

<p>We will demonstrate how to use cutter using this <a href="https://crackmes.one/crackme/5ed17e1633c5d449d91ae68e">crackme</a>.</p>

<p>Crackmes.one has a lot of files that you need to crack and this is a relatively simple one. It’s called ZED-Frequency. Let’s try running it (remember you may need to <code class="language-plaintext highlighter-rouge">chmod+x</code> so that this executable can be run.):</p>

<p><img src="//images/run.png" alt="" class="img-fluid rounded" /></p>

<p>It seemst that you need to pass a keyfile. Let us create a simple file with the text “CSEAIITB” and pass it as a keyfile.</p>

<p>So a particular key is generated from this text. We need to figure out the correct key and what generates this key. This is the challenge. Let’s load this file in cutter.</p>

<p>Open cutter and load this file. Keep on clicking okay we want to use the default settings. You end up here:</p>

<p><img src="//images/cut.png" alt="" class="img-fluid rounded" /></p>

<p>Firstly let’s enable the decompiler. Go to Windows on the menu bar and click on Decompiler. You should see Decompiler now on the bottom. It will load the decompiled code for <code class="language-plaintext highlighter-rouge">entry0</code>. We want to however investigate the <code class="language-plaintext highlighter-rouge">main</code> function so doubleclick on <code class="language-plaintext highlighter-rouge">main</code> in the left side.</p>

<p>This is the code that ghidra gave to us. It may seem complicated but let’s analyse it. Firstly observe that there is a lot of hex codes flying around. Those are simply the memory locations (think pointer values) being passed on. If you click on strings in the bottom you’ll find what values these pointers are pointing to.</p>

<p>Anyway if you observe it seems that <code class="language-plaintext highlighter-rouge">uVar2</code> is storing the file data from the command line <code class="language-plaintext highlighter-rouge">argv</code>. Also at the end you will see that if <code class="language-plaintext highlighter-rouge">iVar1==0</code> (which occurs when <code class="language-plaintext highlighter-rouge">s1</code> is equal to the string at <code class="language-plaintext highlighter-rouge">0xb16</code>) something happens. Let’s go to strings and see.</p>

<p>So if <code class="language-plaintext highlighter-rouge">s1</code> is equal to 01234567890123456789012345 we succeed. This is the key.</p>

<p>How do we get this though? If you look at the source you’ll see that <code class="language-plaintext highlighter-rouge">s1</code> basically is the string form of the data in the array <code class="language-plaintext highlighter-rouge">a1Stack168</code> where the indexing happens from <code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">26</code>.</p>

<p>How is this array getting these values? Observe the main while loop. It seems that the values get updated by considering every character in the input file and updating some value. The <code class="language-plaintext highlighter-rouge">0x41</code> value appears a lot which is the ASCII for <code class="language-plaintext highlighter-rouge">A</code>.</p>

<p>I will leave it to you to see that well this coding is doing nothing but counting the number of occurences of every character from <code class="language-plaintext highlighter-rouge">A</code> to <code class="language-plaintext highlighter-rouge">Z</code>. So a <code class="language-plaintext highlighter-rouge">0</code> in the key at the first position means there is no <code class="language-plaintext highlighter-rouge">A</code> and so on.</p>

<p>We can then easily generate the key!</p>

<p>The following python code generates the key:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"key.txt"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span>
<span class="n">final_key</span> <span class="o">=</span> <span class="s">""</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">26</span><span class="p">):</span>
	<span class="n">final_key</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span><span class="o">+</span><span class="n">_</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">_</span><span class="o">%</span><span class="mi">10</span><span class="p">)</span>

<span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">final_key</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span></code></pre></figure>

<p>Now if we pass this key to the program we see the following output:</p>

<p><img src="//images/fin.png" alt="" class="img-fluid rounded" /></p>

<p>That sums up this crackme. This was a pretty simple example which was made extremely simple using a decompiler. This tool is very useful for complex ctf problems where having a code to go back to while at the same time looking at the assembly can be useful.</p>

  </article>

  

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2021 Pradipta  Bora.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>

    
    Last updated: November 23, 2021.
    
  </div>
</footer>



  </body>

  <!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>

<!-- Load DarkMode JS -->
<script src="/assets/js/dark_mode.js"></script>


</html>
